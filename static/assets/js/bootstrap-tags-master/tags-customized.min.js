const DEFAULTS={allowNew:!1,showAllSuggestions:!1,badgeStyle:"tag",allowClear:!1,clearEnd:!1,selected:[],regex:"",separator:[],max:0,clearLabel:"Clear",searchLabel:"Type a value",keepOpen:!1,allowSame:!1,baseClass:"",placeholder:"",addOnBlur:!1,showDisabled:!1,hideNativeValidation:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,fixed:!1,activeClasses:["active-tag"],labelField:"label",valueField:"value",queryParam:"query",server:"",serverMethod:"GET",serverParams:{},fetchOptions:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",selectedColor:"",onRenderItem:(e,t,s)=>t,onInputChart:e=>{},onSelectItem:(e,t)=>{},onClearItem:(e,t)=>{},onCanAdd:(e,t,s)=>{},onServerResponse:e=>e.json()},CLASS_PREFIX="tags-",LOADING_CLASS="is-loading",ACTIVE_CLASS="is-active",INVALID_CLASS="is-invalid",SHOW_CLASS="show",VALUE_ATTRIBUTE="data-value",NEXT="next",PREV="prev",FOCUS_CLASS="form-control-focus",PLACEHOLDER_CLASS="form-placeholder-shown",DISABLED_CLASS="form-control-disabled",INSTANCE_MAP=new WeakMap;let counter=0;function debounce(e,t=300){let s;return(...i)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(this,i)}),t)}}function calcTextWidth(e,t=null){const s=document.createElement("span");document.body.appendChild(s),s.style.fontSize=t||"inherit",s.style.height="auto",s.style.width="auto",s.style.position="absolute",s.style.whiteSpace="no-wrap",s.innerHTML=e;const i=Math.ceil(s.clientWidth)+8;return document.body.removeChild(s),i}function removeDiacritics(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function hideItem(e){e.style.display="none",e.ariaHidden="true"}function showItem(e){e.style.display="list-item",e.ariaHidden="false"}class BootstrapInputsTags{constructor(e,t={}){e instanceof HTMLElement?(INSTANCE_MAP.set(e,this),counter++,this._selectElement=e,this._configure(t),this._keyboardNavigation=!1,this._searchFunc=debounce((()=>{this._loadFromServer(!0)}),this._config.debounceTime),this._fireEvents=!0,this._configureParent(),this._holderElement=document.createElement("div"),this._containerElement=document.createElement("div"),this._holderElement.appendChild(this._containerElement),this._selectElement.parentElement.insertBefore(this._holderElement,this._selectElement),this._configureHolderElement(),this._configureContainerElement(),this._configureSelectElement(),this._configureSearchInput(),this._configureDropElement(),this.resetState(),this._config.fixed&&(document.addEventListener("scroll",this,!0),window.addEventListener("resize",this)),this._searchInput.addEventListener("focus",this),this._searchInput.addEventListener("blur",this),this._searchInput.addEventListener("input",this),this._searchInput.addEventListener("keydown",this),this._dropElement.addEventListener("mousemove",this),this.loadData()):console.error("Invalid element",e)}changeColor(e){this._config.selectedColor=e}static init(e="select[multiple]",t={}){let s=document.querySelectorAll(e);for(let e=0;e<s.length;e++)if(!BootstrapInputsTags.getInstance(s[e]))return new BootstrapInputsTags(s[e],t)}static getInstance(e){if(INSTANCE_MAP.has(e))return INSTANCE_MAP.get(e)}dispose(){this._searchInput.removeEventListener("focus",this),this._searchInput.removeEventListener("blur",this),this._searchInput.removeEventListener("input",this),this._searchInput.removeEventListener("keydown",this),this._dropElement.removeEventListener("mousemove",this),this._config.fixed&&(document.removeEventListener("scroll",this,!0),window.removeEventListener("resize",this)),this._selectElement.style.display="block",this._holderElement.parentElement.removeChild(this._holderElement),this.parentForm&&this.parentForm.removeEventListener("reset",this),INSTANCE_MAP.delete(this._selectElement)}handleEvent(e){this[`on${e.type}`](e)}_configure(e={}){this._config=Object.assign({},DEFAULTS);const t={...e,...this._selectElement.dataset},s=e=>["true","false","1","0",!0,!1].includes(e)&&!!JSON.parse(e);for(const[e,i]of Object.entries(DEFAULTS)){if(void 0===t[e])continue;const n=t[e];switch(typeof i){case"number":this._config[e]=parseInt(n);break;case"boolean":this._config[e]=s(n);break;case"string":this._config[e]=n.toString();break;case"object":if(Array.isArray(i)){const t=n.includes("|")?"|":",";this._config[e]="string"==typeof n?n.split(t):n}else this._config[e]="string"==typeof n?JSON.parse(n):n;break;case"function":this._config[e]="string"==typeof n?window[n]:n;break;default:this._config[e]=n}}this._config.placeholder||(this._config.placeholder=this._getPlaceholder())}_configureParent(){for(this.overflowParent=null,this.parentForm=this._selectElement.parentElement;this.parentForm&&("hidden"===this.parentForm.style.overflow&&(this.overflowParent=this.parentForm),this.parentForm=this.parentForm.parentElement,!this.parentForm||"FORM"!=this.parentForm.nodeName););this.parentForm&&this.parentForm.addEventListener("reset",this)}_getPlaceholder(){if(this._selectElement.hasAttribute("placeholder"))return this._selectElement.getAttribute("placeholder");if(this._selectElement.dataset.placeholder)return this._selectElement.dataset.placeholder;let e=this._selectElement.querySelector("option");return e?(e.hasAttribute("selected")&&e.removeAttribute("selected"),e.value?"":e.textContent):""}_configureSelectElement(){this._config.hideNativeValidation?(this._selectElement.style.position="absolute",this._selectElement.style.left="-9999px"):this._selectElement.style.cssText="height:1px;width:1px;opacity:0;padding:0;margin:0;border:0;float:left;flex-basis:100%;",this._selectElement.tabIndex=-1,this._selectElement.addEventListener("focus",(e=>{this.onclick()})),this._selectElement.addEventListener("invalid",(e=>{this._holderElement.classList.add("is-invalid")}))}_configureDropElement(){this._dropElement=document.createElement("ul"),this._dropElement.classList.add("dropdown-menu","tags-menu","p-0"),this._dropElement.setAttribute("id","tags-menu-"+counter),this._dropElement.setAttribute("role","menu"),this._dropElement.style.maxHeight="280px",this._config.fullWidth||(this._dropElement.style.maxWidth="360px"),this._config.fixed&&(this._dropElement.style.position="fixed"),this._dropElement.style.overflowY="auto",this._dropElement.style.overscrollBehavior="contain",this._dropElement.style.textAlign="unset",this._dropElement.addEventListener("mouseenter",(e=>{this._keyboardNavigation=!1})),this._holderElement.appendChild(this._dropElement),this._searchInput.setAttribute("aria-controls",this._dropElement.getAttribute("id"))}_configureHolderElement(){this._holderElement.classList.add("form-control","dropdown"),this._selectElement.classList.contains("form-select-lg")&&this._holderElement.classList.add("form-control-lg"),this._selectElement.classList.contains("form-select-sm")&&this._holderElement.classList.add("form-control-sm"),this.overflowParent&&(this._holderElement.style.position="inherit"),4===this._getBootstrapVersion()&&(this._holderElement.style.height="auto")}_configureContainerElement(){this._containerElement.addEventListener("click",(e=>{this.isDisabled()||"hidden"!=this._searchInput.style.visibility&&this._searchInput.focus()})),this._containerElement.style.display="flex",this._containerElement.style.alignItems="center",this._containerElement.style.flexWrap="wrap";const e=this._selectElement.selectedOptions||[];for(let t=0;t<e.length;t++){let s=e[t];s.value&&(s.setAttribute("selected","selected"),s.dataset.init="true",s.hasAttribute("disabled")&&(s.dataset.disabled="true"),this._createBadge(s.textContent,s.value,s.dataset))}}_configureSearchInput(){this._searchInput=document.createElement("input"),this._searchInput.addEventListener("input",(e=>{this._config.onInputChart(e.target.value)})),this._searchInput.type="text",this._searchInput.autocomplete="off",this._searchInput.spellcheck=!1,this._searchInput.ariaAutoComplete="list",this._searchInput.ariaExpanded="false",this._searchInput.ariaHasPopup="menu",this._searchInput.setAttribute("role","combobox"),this._searchInput.ariaLabel=this._config.searchLabel,this._searchInput.style.cssText="backgroundColor:transparent;color:currentColor;border:0;padding:4px 0 4px 4px;outline:0;maxWidth:100%",this.resetSearchInput(!0),this._containerElement.appendChild(this._searchInput)}onfocus(e){this._holderElement.classList.add(FOCUS_CLASS),this.showOrSearch()}onblur(e){this._abortController&&this._abortController.abort(),this._holderElement.classList.remove(FOCUS_CLASS),this.hideSuggestions(),this._config.keepOpen&&this.resetSearchInput();const t=this.getSelection(),s={selection:t?t.dataset.value:null,input:this._searchInput.value};this._config.addOnBlur&&this._config.allowNew&&(this._searchInput.dispatchEvent(new KeyboardEvent("keydown",{code:"Enter",key:"Enter",charCode:13,keyCode:13,view:window,bubbles:!0})),this.resetSearchInput()),this._fireEvents&&this._selectElement.dispatchEvent(new CustomEvent("tags.blur",{bubbles:!0,detail:s}))}oninput(e){const t=this._searchInput.value;if(t){const e=t.slice(-1);if(this._config.separator.length&&this._config.separator.includes(e)){this._searchInput.value=this._searchInput.value.slice(0,-1);let e=this._searchInput.value,t=e;if(!this._config.allowNew){const s=this.getSelection();if(!s)return;e=s.getAttribute("data-value"),t=s.dataset.label}return void this._add(t,e)}}setTimeout((()=>{this._adjustWidth()})),this.showOrSearch()}onkeydown(e){let t=e.keyCode||e.key;const s=e.target;switch(229==e.keyCode&&(t=s.value.charAt(s.selectionStart-1).charCodeAt(0)),t){case 13:case"Enter":e.preventDefault();let t=this.getSelection();if(t)t.click();else if(this._config.allowNew&&this._searchInput.value){let e=this._searchInput.value;this._add(e,e,{new:1,styleColor:this._config.selectedColor})}break;case 38:case"ArrowUp":e.preventDefault(),this._keyboardNavigation=!0,this._moveSelection(PREV);break;case 40:case"ArrowDown":e.preventDefault(),this._keyboardNavigation=!0,this.isDropdownVisible()?this._moveSelection(NEXT):this.showOrSearch(!1);break;case 8:case"Backspace":0==this._searchInput.value.length&&(this.removeLastItem(),this._adjustWidth(),this.showOrSearch());break;case 27:case"Escape":this._searchInput.focus(),this.hideSuggestions()}}onmousemove(e){this._keyboardNavigation=!1}onscroll(e){this._positionMenu()}onresize(e){this._positionMenu()}onclick(e){this._searchInput.focus()}onreset(e){this.reset()}loadData(){this._config.server?this._config.liveServer||this._loadFromServer():this.resetSuggestions()}resetState(){this.isDisabled()?(this._holderElement.setAttribute("readonly",""),this._searchInput.setAttribute("disabled",""),this._holderElement.classList.add(DISABLED_CLASS)):(this._holderElement.hasAttribute("readonly")&&this._holderElement.removeAttribute("readonly"),this._searchInput.hasAttribute("disabled")&&this._searchInput.removeAttribute("disabled"),this._holderElement.classList.remove(DISABLED_CLASS))}resetSuggestions(){let e=Array.from(this._selectElement.children).filter((e=>e instanceof HTMLOptGroupElement||!e.disabled||this._config.showDisabled)).map((e=>e instanceof HTMLOptGroupElement?{group:e.getAttribute("label"),items:e.children}:{value:e.getAttribute("value"),label:e.textContent,disabled:e.disabled,data:Object.assign({},e.dataset)}));this._buildSuggestions(e)}_loadFromServer(e=!1){this._abortController&&this._abortController.abort(),this._abortController=new AbortController;const t=Object.assign({},this._config.serverParams);if(t[this._config.queryParam]=this._searchInput.value,this._config.noCache&&(t.t=Date.now()),t.related){const e=document.getElementById(t.related);e&&(t.related=e.value)}const s=new URLSearchParams(t);let i=this._config.server,n=Object.assign(this._config.fetchOptions,{method:this._config.serverMethod||"GET",signal:this._abortController.signal});"POST"===n.method?n.body=s:i+="?"+s.toString(),this._holderElement.classList.add("is-loading"),fetch(i,n).then((e=>this._config.onServerResponse(e))).then((t=>{let s=t.data||t;this._buildSuggestions(s),this._abortController=null,e&&this._showSuggestions()})).catch((e=>{"AbortError"!==e.name&&console.error(e)})).finally((e=>{this._holderElement.classList.remove("is-loading")}))}_add(e,t=null,s={}){if(!this.canAdd(e,s))return null;const i=this.addItem(e,t,s);return this._config.keepOpen?this._showSuggestions():this.resetSearchInput(),i}_isItemEnabled(e){if("none"===e.style.display)return!1;const t=e.firstElementChild;return"A"===t.tagName&&!t.classList.contains("disabled")}_moveSelection(e=NEXT,t=null){const s=this.getSelection();if(s){const i=e===NEXT?"nextSibling":"previousSibling";t=s.parentNode;do{t=t[i]}while(t&&!this._isItemEnabled(t));t?s.classList.remove(...this._activeClasses()):s&&(t=s.parentElement)}else{if(e===PREV)return t;if(!t)for(t=this._dropElement.firstChild;t&&!this._isItemEnabled(t);)t=t.nextSibling}if(t){const s=t.offsetHeight,i=t.offsetTop,n=t.parentNode,l=n.offsetHeight,o=n.scrollHeight,r=n.offsetTop;if(0===s&&setTimeout((()=>{n.scrollTop=0})),e===PREV){const e=i-r>10?i-r:0;n.scrollTop=e}else{i+s-(l+n.scrollTop)>0&&s>0&&(n.scrollTop=i+s-l+1,n.scrollTop+l>=o-10&&(n.scrollTop=i-r))}const a=t.querySelector("a");a.classList.add(...this._activeClasses()),this._searchInput.setAttribute("aria-activedescendant",a.getAttribute("id")),this._config.updateOnSelect&&(this._searchInput.value=a.dataset.label,this._adjustWidth())}else this._searchInput.setAttribute("aria-activedescendant","");return t}_adjustWidth(){this._holderElement.classList.remove(PLACEHOLDER_CLASS),this._searchInput.value?this._searchInput.size=this._searchInput.value.length:this.getSelectedValues().length?(this._searchInput.placeholder="",this._searchInput.size=1):(this._searchInput.size=this._config.placeholder.length>0?this._config.placeholder.length:1,this._searchInput.placeholder=this._config.placeholder,this._holderElement.classList.add(PLACEHOLDER_CLASS));const e=calcTextWidth(this._searchInput.value||this._searchInput.placeholder,window.getComputedStyle(this._holderElement).fontSize);this._searchInput.style.width=e+"px"}_buildSuggestions(e){for(;this._dropElement.lastChild;)this._dropElement.removeChild(this._dropElement.lastChild);let t=0,s=1;for(let i=0;i<e.length;i++){const n=e[i];if(n.group){const e=document.createElement("li");e.setAttribute("role","presentation"),e.dataset.id=""+s;const i=document.createElement("span");if(e.append(i),i.classList.add("dropdown-header","text-truncate"),i.innerHTML=n.group,this._dropElement.appendChild(e),n.items)for(let e=0;e<n.items.length;e++){n.items[e].group_id=s,this._buildSuggestionsItem(n.items[e],t),t++}s++}this._buildSuggestionsItem(n,t),t++}if(this._config.notFoundMessage){const e=document.createElement("li");e.setAttribute("role","presentation"),e.classList.add("tags-not-found"),e.innerHTML=`<span class="dropdown-item">${this._config.notFoundMessage}</span>`,this._dropElement.appendChild(e)}}_buildSuggestionsItem(e,t){if(!e[this._config.valueField])return;const s=e[this._config.valueField],i=e[this._config.labelField];if(this._config.server&&!this._config.liveServer&&(e.selected||this._config.selected.includes(s))){const t=this._add(i,s,e.data);t&&(t.dataset.init="true")}let n=this._config.onRenderItem(e,i,this);const l=document.createElement("li");l.setAttribute("role","presentation"),l.classList.add("dropdown-item__li"),e.group_id&&l.setAttribute("data-group-id",""+e.group_id);const o=document.createElement("a"),r=document.createElement("span");e.data.styleColor&&(r.style.color=e.data.styleColor,r.style.borderColor=e.data.styleColor,r.style.borderWidth="1px",r.style.borderStyle="solid"),l.append(o),o.setAttribute("id",this._dropElement.getAttribute("id")+"-"+t),o.classList.add("dropdown-item"),e.disabled&&o.classList.add("disabled"),o.setAttribute("data-value",s),o.setAttribute("data-label",i),o.setAttribute("href","#"),r.innerHTML=n,o.appendChild(r),this._dropElement.appendChild(l),o.addEventListener("mouseenter",(e=>{this._keyboardNavigation||(this.removeSelection(),l.querySelector("a").classList.add(...this._activeClasses()))})),o.addEventListener("mousedown",(e=>{e.preventDefault()})),o.addEventListener("click",(t=>{t.preventDefault(),this._add(i,s,e.data),this._config.onSelectItem(e,this)}))}initialOptions(){return this._selectElement.querySelectorAll("option[data-init]")}reset(){this.removeAll(),this._fireEvents=!1;const e=this.initialOptions();for(let t=0;t<e.length;t++){const s=e[t];this.addItem(s.textContent,s.value,s.dataset)}this._adjustWidth(),this._fireEvents=!0}resetSearchInput(e=!1){this._searchInput.value="",this._adjustWidth(),e||(this.hideSuggestions(),this._searchInput===document.activeElement&&this._searchInput.dispatchEvent(new Event("input"))),this._config.max&&this.getSelectedValues().length>=this._config.max?this._searchInput.style.visibility="hidden":"hidden"==this._searchInput.style.visibility&&(this._searchInput.style.visibility="visible"),this.isSingle()&&!e&&document.activeElement.blur()}getSelectedValues(){const e=this._selectElement.querySelectorAll("option[selected]");return Array.from(e).map((e=>e.value))}getFullSelectedValues(){const e=this._selectElement.querySelectorAll("option[selected]");return Array.from(e).map((e=>({title:e.value,hex:e.dataset.styleColor})))}getAvailableValues(){const e=this._selectElement.querySelectorAll("option");return Array.from(e).map((e=>e.value))}showOrSearch(e=!0){!e||this._shouldShow()?this._config.liveServer?this._searchFunc():this._showSuggestions():this.hideSuggestions(!1)}hideSuggestions(e=!0){this._dropElement.classList.remove("show"),this._searchInput.ariaExpanded="false",this.removeSelection(),e&&this._holderElement.classList.remove("is-invalid")}toggleSuggestions(e=!0,t=!0){this._dropElement.classList.contains("show")?this.hideSuggestions(t):this.showOrSearch(e)}_shouldShow(){return!this.isDisabled()&&(!(this._config.maximumItems>0&&this.getSelectedValues().length>=this._config.maximumItems)&&this._searchInput.value.length>=this._config.suggestionsThreshold)}_showSuggestions(){if("hidden"==this._searchInput.style.visibility)return;const e=removeDiacritics(this._searchInput.value).toLowerCase(),t=this.getSelectedValues(),s=this._dropElement.querySelectorAll("li");let i=0,n=null,l=!1,o={};for(let r=0;r<s.length;r++){let a=s[r],h=a.firstElementChild;if(h instanceof HTMLSpanElement){a.dataset.id&&(o[a.dataset.id]=!1),hideItem(a);continue}if(h.classList.remove(...this._activeClasses()),!this._config.allowSame&&-1!=t.indexOf(h.getAttribute("data-value"))){hideItem(a);continue}const c=removeDiacritics(h.textContent).toLowerCase(),d=e.length>0?c.indexOf(e):-1,u=d>=0||0===e.length&&0===this._config.suggestionsThreshold,_=this._config.showAllSuggestions||0===e.length,m=u||0===e.length;if(_||u?(i++,showItem(a),a.dataset.groupId&&(o[a.dataset.groupId]=!0),!n&&m&&(n=a),this._config.maximumItems>0&&i>this._config.maximumItems&&hideItem(a)):hideItem(a),this._config.highlightTyped&&u){const t=h.textContent,s=t.substring(0,d)+`<mark>${t.substring(d,d+e.length)}</mark>`+t.substring(d+e.length,t.length);h.innerHTML=s}this._isItemEnabled(a)&&(l=!0)}if(this._config.allowNew||0===e.length&&!l||this._holderElement.classList.add("is-invalid"),this._config.allowNew&&this._config.regex&&this.isInvalid()&&this._holderElement.classList.remove("is-invalid"),Array.from(s).filter((e=>e.dataset.id)).forEach((e=>{!0===o[e.dataset.id]&&showItem(e)})),l&&(this._holderElement.classList.remove("is-invalid"),n&&this._config.autoselectFirst&&(this.removeSelection(),this._moveSelection(NEXT,n))),0===i)if(this._config.notFoundMessage){this._dropElement.querySelector(".tags-not-found").style.display="block",this._showDropdown()}else this.hideSuggestions(!1);else this._showDropdown()}_showDropdown(){this._dropElement.classList.add("show"),this._searchInput.ariaExpanded="true",this._positionMenu()}_positionMenu(){const e=window.getComputedStyle(this._searchInput),t=this._searchInput.getBoundingClientRect(),s="rtl"===e.direction;let i=null,n=null;if(this._config.fixed){if(this._config.fullWidth){i=this._holderElement.getBoundingClientRect().x}else i=t.x;n=t.y+t.height}else i=this._config.fullWidth?0:this._searchInput.offsetLeft;if(s&&!this._config.fullWidth&&(i-=this._dropElement.offsetWidth-t.width),!this._config.fullWidth){const e=Math.min(window.innerWidth,document.body.offsetWidth),n=s?t.x+t.width-this._dropElement.offsetWidth-1:e-1-(t.x+this._dropElement.offsetWidth);n<0&&(i=s?i-n:i+n)}this._dropElement.style.transform="unset",this._config.fullWidth&&(this._dropElement.style.width=this._holderElement.offsetWidth+"px"),null!==i&&(this._dropElement.style.left=i+"px"),null!==n&&(this._dropElement.style.top=n+"px");const l=this._dropElement.getBoundingClientRect(),o=Math.min(window.innerHeight,document.body.offsetHeight);o-1-(l.y+l.height)<0&&t.y>o/2&&(this._dropElement.style.transform="translateY(calc(-100% - "+this._searchInput.offsetHeight+"px))")}_getBootstrapVersion(){let e=5;return window.jQuery&&null!=$.fn.tooltip&&null!=$.fn.tooltip.Constructor&&(e=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),e}_isSelected(e){const t=Array.from(this._selectElement.querySelectorAll("option")).find((t=>t.textContent==e));return!(!t||!t.getAttribute("selected"))}_validateRegex(e){return new RegExp(this._config.regex.trim()).test(e)}getSelection(){return this._dropElement.querySelector("a.is-active")}removeSelection(){const e=this.getSelection();e&&e.classList.remove(...this._activeClasses())}_activeClasses(){return[...this._config.activeClasses,"is-active"]}getActiveSelection(){return this.getSelection()}removeActiveSelection(){return this.removeSelection()}removeAll(){this.getSelectedValues().forEach((e=>{this.removeItem(e,!0)})),this._adjustWidth()}removeLastItem(e=!1){let t=this._containerElement.querySelectorAll("span.badge:not(.disabled)");if(!t.length)return;let s=t[t.length-1];this.removeItem(s.getAttribute("data-value"),e)}enable(){this._selectElement.setAttribute("disabled",""),this.resetState()}disable(){this._selectElement.removeAttribute("disabled"),this.resetState()}isDisabled(){return this._selectElement.hasAttribute("disabled")||this._selectElement.disabled||this._selectElement.hasAttribute("readonly")}isDropdownVisible(){return this._dropElement.classList.contains("show")}isInvalid(){return this._holderElement.classList.contains("is-invalid")}isSingle(){return!this._selectElement.hasAttribute("multiple")}canAdd(e,t={}){return!!e&&(!this.isDisabled()&&(!(!this.isSingle()&&!this._config.allowSame&&this._isSelected(e))&&(!(this._config.max&&this.getSelectedValues().length>=this._config.max)&&(this._config.regex&&t.new&&!this._validateRegex(e)?(this._holderElement.classList.add("is-invalid"),!1):!this._config.onCanAdd||!1!==this._config.onCanAdd(e,t,this)||(this._holderElement.classList.add("is-invalid"),!1)))))}addItem(e,t=null,s={}){t||(t=e),this.isSingle()&&this.getSelectedValues().length&&this.removeLastItem(!0);const i=CSS.escape(t);let n=this._selectElement.querySelectorAll('option[value="'+i+'"]'),l=null;if(this._config.allowSame?n.forEach((t=>{t.textContent!==e||t.selected||(l=t)})):l=n[0]||null,!l){l=document.createElement("option"),l.value=t,l.textContent=e;for(const[e,t]of Object.entries(s))l.dataset[e]=t;this._selectElement.appendChild(l)}l&&(s=Object.assign({},s,l.dataset)),l.setAttribute("selected","selected"),l.selected=!0;const o=this._selectElement.innerHTML;return this._selectElement.innerHTML="",this._selectElement.innerHTML=o,this._createBadge(e,t,s),this._fireEvents&&this._selectElement.dispatchEvent(new Event("change",{bubbles:!0})),l}_createBadge(e,t=null,s={}){const i=this._getBootstrapVersion(),n=this._config.allowClear&&!s.disabled;let l=e,o=document.createElement("span"),r=["badge"],a=this._config.badgeStyle;if(s.badgeStyle&&(a=s.badgeStyle),s.badgeClass&&r.push(...s.badgeClass.split(" ")),this._config.baseClass?r.push(...this._config.baseClass.split(" ")):r=5===i?[...r,"bg-"+a,"mw-100","overflow-x-hidden"]:[...r,"badge-"+a],s.disabled&&r.push("disabled","opacity-50"),o.style.margin="2px 6px 2px 0px",o.style.marginBlock="2px",o.style.marginInline="0px 6px",o.classList.add(...r),s?.styleColor?(o.style.color=s?.styleColor,o.style.borderColor=s?.styleColor):(o.style.color=this._config.selectedColor,o.style.borderColor=this._config.selectedColor),o.style.borderStyle="solid",o.style.borderWidth="1px",o.setAttribute("data-value",t),n){const e=r.includes("text-dark")?"btn-close":"btn-close-white";let t,s;this._config.clearEnd?(t=5===i?"ms-2":"ml-2",s=5===i?"float-end":"float:right;"):(t=5===i?"me-2":"mr-2",s=5===i?"float-start":"float:left;");l=(5===i?'<button type="button" class="'+t+" "+s+" btn-close "+e+'" aria-label="'+this._config.clearLabel+'"></button>':'<button type="button"'+s+'text-shadow:none;color:currentColor;" class=" close" aria-label="'+this._config.clearLabel+'"><span aria-hidden="true" class="ml-1"><i class="icon__16x16 icon-close__16"></i></span></button>')+l}o.innerHTML=l,this._containerElement.insertBefore(o,this._searchInput),n&&o.querySelector("button").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.isDisabled()||(this.removeItem(t),document.activeElement.blur(),this._adjustWidth())}))}removeItem(e,t=!1){const s=CSS.escape(e);let i=this._containerElement.querySelector('span[data-value="'+s+'"]');if(!i)return;i.remove();let n=this._selectElement.querySelector('option[value="'+s+'"][selected]');n&&(n.removeAttribute("selected"),n.selected=!1,this._fireEvents&&!t&&this._selectElement.dispatchEvent(new Event("change",{bubbles:!0}))),"hidden"==this._searchInput.style.visibility&&this._config.max&&this.getSelectedValues().length<this._config.max&&(this._searchInput.style.visibility="visible"),t||this._config.onClearItem(e,this)}}